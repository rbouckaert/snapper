<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" version="2.0">

<!-- Data -->
<!--
The SNP data matrix, converted to binary format from file .
-->
<data id="snps" dataType="integer" name="rawdata">
    <sequence id="seq_IZA1" taxon="IZA1" totalcount="3" value="2022"/>
    <sequence id="seq_IZC5" taxon="IZC5" totalcount="3" value="2022"/>
    <sequence id="seq_AUE7" taxon="AUE7" totalcount="3" value="2000"/>
    <sequence id="seq_AXD5" taxon="AXD5" totalcount="3" value="2000"/>
    <sequence id="seq_JBD5" taxon="JBD5" totalcount="3" value="220-"/>
    <sequence id="seq_JBD6" taxon="JBD6" totalcount="3" value="2200"/>
    </data>                                                    

<!-- Maps -->
<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>
<map name="prior" >beast.math.distributions.Prior</map>

<run id="mcmc" spec="MCMC" chainLength="1000" storeEvery="50">

    <!-- State -->
    <state id="state" storeEvery="50">
        <stateNode id="tree" spec="beast.util.ClusterTree" clusterType="upgma" nodetype="snap.NodeData">
  
            <taxa id="data" spec="snapper.Data" dataType="integerdata">
                <rawdata idref="snps"/>
                <taxonset id="astbur" spec="TaxonSet">
                    <taxon id="IZA1" spec="Taxon"/>
                    <taxon id="IZC5" spec="Taxon"/>
                </taxonset>
                <taxonset id="altfas" spec="TaxonSet">
                    <taxon id="AUE7" spec="Taxon"/>
                    <taxon id="AXD5" spec="Taxon"/>
                </taxonset>
                <taxonset id="telvit" spec="TaxonSet">
                    <taxon id="JBD5" spec="Taxon"/>
                    <taxon id="JBD6" spec="Taxon"/>
                </taxonset>
            </taxa>
        </stateNode>
        <!-- Parameter starting values -->
        <parameter id="lambda" lower="0.0" name="stateNode">0.1</parameter>
        <parameter id="coalescenceRate" lower="0.0" name="stateNode">200.0</parameter>
        <parameter id="clockRate" lower="0.0" name="stateNode">0.01</parameter>
    </state>

    <!-- Posterior -->
    <distribution id="posterior" spec="util.CompoundDistribution">
        <distribution id="prior" spec="util.CompoundDistribution">

            <!-- Divergence age priors -->
            <distribution id="Clade0001" spec="beast.math.distributions.MRCAPrior" useOriginate="false" monophyletic="true"  tree="@tree">
                <taxonset id="Constraint0001" spec="TaxonSet">
                    <taxon idref="astbur"/>
                    <taxon idref="altfas"/>
                    <taxon idref="telvit"/>
                </taxonset>
                <LogNormal meanInRealSpace="true" name="distr" offset="0">
                    <parameter estimate="false" lower="0.0" name="M">7.02</parameter>
                    <parameter estimate="false" lower="0.0" name="S">0.13</parameter>
                </LogNormal>
            </distribution>
            <!--
            The clock rate affects the model only by scaling branches before likelihood calculations.
            A one-on-x prior distribution is used, which has the advantage that the shape of its
            distribution is independent of the time scales used, and can therefore equally be applied
            in phylogenetic analyses of very recent or old groups. However, note that the one-on-x
            prior distribution is not a proper probability distribution as its total probability mass
            does not sum to 1. For this reason, this prior distribution can not be used for Bayes Factor
            comparison based on Path Sampling or Stepping Stone analyses. If such analyses are to be
            performed, a different type of prior distribution (uniform, lognormal, gamma,...) will need
            to be chosen.
            -->
            <prior name="distribution" x="@clockRate">
                <OneOnX name="distr"/>
            </prior>
            <!--
            The scaling of branch lengths based on the clock rate does not affect the evaluation of the
            likelihood of the species tree given the speciation rate lambda. Thus, lambda is measured in
            the same time units as the unscaled species tree. As for the clock rate, a one-on-x prior
            distribution is used, and an alternative prior distribution will need to be chosen if Bayes
            Factor comparisons are to be performed.
            -->
            <prior name="distribution" x="@lambda">
                <OneOnX name="distr"/>
            </prior>
            <!--
            The below distribution defines the prior probability for the population mutation rate Theta.
            In standard SNAPP analyses, a gamma distribution is commonly used to define this probability,
            with a mean according to expectations based on the assumed mean effective population size
            (across all branches) and the assumed mutation rate per site and generation. However, with
            SNP matrices, the mutation rate of selected SNPs usually differs strongly from the genome-wide
            mutation rate, and the degree of this difference depends on the way in which SNPs were selected
            for the analysis. The SNP matrices used for this analysis are assumed to all be bi-allelic,
            excluding invariable sites, and are thus subject to ascertainment bias that will affect the
            mutation rate estimate. If only a single species would be considered, this ascertainment bias
            could be accounted for (Kuhner et al. 2000; Genetics 156: 439â€“447). However, with multiple
            species, the proportion of SNPs that are variable among individuals of the same species,
            compared to the overall number of SNPs variable among all species, depends on relationships
            between species and the age of the phylogeny, parameters that are to be inferred in the analysis.
            Thus, SNP ascertainment bias can not be accounted for before the analysis, and the prior
            expectation of Theta is extremely vague. Therefore, a uniform prior probability distribution
            is here used for this parameter, instead of the commonly used gamma distribution. By default,
            SNAPP uses a lower boundary of 0 and an upper boundary of 10000 when a uniform prior probability
            distribution is chosen for Theta, and these lower and upper boundaries can not be changed without
            editing the SNAPP source code. Regardless of the wide boundaries, the uniform distribution works
            well in practice, at least when the Theta parameter is constrained to be identical on all branches
            (see below).
            -->
            <distribution spec="snap.likelihood.SnAPPrior" coalescenceRate="@coalescenceRate" lambda="@lambda" rateprior="uniform" tree="@tree">
                <!--
                SNAPPER requires input for parameters alpha and beta regardless of the chosen type of prior,
                however, the values of these two parameters are ignored when a uniform prior is selected.
                Thus, they are both set arbitrarily to 1.0.
                -->
                <parameter estimate="false" lower="0.0" name="alpha">1.0</parameter>
                <parameter estimate="false" lower="0.0" name="beta">1.0</parameter>
            </distribution>
        </distribution>
        <distribution id="likelihood" spec="util.CompoundDistribution">
            <distribution spec="snapper.SnapperTreeLikelihood" id="SnapperTreeLikelihood" data="@data" initFromTree="false" pattern="theta" useBetaRootPrior="true" tree="@tree">
                <siteModel spec="SiteModel">
                    <substModel spec="snapper.SnapSubstitutionModel">
                        <!--
                        The forward and backward mutation rates are fixed so that the number of expected mutations
                        per time unit (after scaling branch lengths with the clock rate) is 1.0. This is done to
                        avoid non-identifability of rates, given that the clock rate is estimated. Both parameters
                        are fixed at the same values, since it is assumed that alleles were translated to binary
                        code by random assignment of '0' and '2' to homozygous alleles, at each site individually.
                        Thus, the probabilities for '0' and '2' are identical and the resulting frequencies of '0'
                        and '2' in the data matrix should be very similar.
                        -->
                        <parameter estimate="false" lower="0.0" name="mutationRateU">1.0</parameter>
                        <parameter estimate="false" lower="0.0" name="mutationRateV">1.0</parameter>
                        <coalescentRate idref="coalescenceRate"/>
                    </substModel>
                </siteModel>
                <!--
                A strict clock rate is used, assuming that only closely related species are used in SNAPPER
                analyses and that branch rate variation among closely related species is negligible.
                The use of a relaxed clock is not supported in SNAPPER.
                -->
                <branchRateModel spec="beast.evolution.branchratemodel.StrictClockModel" clock.rate="@clockRate"/>
            </distribution>
        </distribution>
    </distribution>

    <!-- Operators -->
    <!--
    The treeNodeSwapper operator is the only operator on the tree topology. Thus if the tree topology
    should be fixed, simply remove this operator by deleting the second-next line.
    -->
    <operator id="treeNodeSwapper" spec="snap.operators.NodeSwapper" tree="@tree" weight="1.0"/>
    <!--
    The treeNodeBudger and treeScaler operators modify node heights of the tree.
    -->
    <operator id="treeNodeBudger" spec="snap.operators.NodeBudger" size="0.75" tree="@tree" weight="1.0"/>
    <operator id="treeScaler" spec="snap.operators.ScaleOperator" scaleFactor="0.75" tree="@tree" weight="1.0"/>
    <!--
    To constrain the Theta parameter so that all branches always share the same value (and thus
    the same population size estimates), a single operator is used to modify Theta values by scaling
    the Thetas of all branches up or down by the same factor. Instead, SNAPPER's default Theta operator
    types 'GammaMover' and 'RateMixer' are not not used.
    -->
    <operator id="thetaScaler" spec="snap.operators.ScaleOperator" parameter="@coalescenceRate" scaleFactor="0.75" scaleAll="true" weight="1.0"/>
    <!--
    The lamdaScaler and clockScaler operators modify the speciation and clock rates.
    -->
    <operator id="lamdaScaler" spec="snap.operators.ScaleOperator" parameter="@lambda" scaleFactor="0.75" weight="1.0"/>
    <operator id="clockScaler" spec="snap.operators.ScaleOperator" parameter="@clockRate" scaleFactor="0.75" weight="1.0"/>

    <!-- Loggers -->
    <logger fileName="snapper2.log" logEvery="50">
        <log idref="posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
        <log idref="lambda"/>
        <log id="treeHeightLogger" spec="beast.evolution.tree.TreeHeightLogger" tree="@tree"/>
        <log idref="clockRate"/>
    </logger>
    <logger logEvery="50">
        <log idref="posterior"/>
        <log spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
        <log idref="treeHeightLogger"/>
        <log idref="clockRate"/>
    </logger>
    <logger fileName="snapper2.trees" logEvery="50" mode="tree">
        <log spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@tree">
            <metadata id="theta" spec="snap.RateToTheta" coalescenceRate="@coalescenceRate"/>
        </log>
    </logger>

</run>

</beast>
